#!/bin/bash

LOG_DIR=/home/wiley/lib/log
FILES=`ls -al $LOG_DIR/runlog.* | awk '{print $NF}'`

for i in $FILES; do
    bzip2 -9q "$i"
done

THE_YEAR=`date '+%Y'`
THE_MONTH=`date '+%m'`

if [ $THE_MONTH -ge 1 -a $THE_YEAR -ge 1 ]; then
    LAST_MONTH=$[ $THE_MONTH - 1 ]
    if [ $LAST_MONTH -eq 0 ]; then
        THE_YEAR=$[ $THE_YEAR - 1 ]
        THE_MONTH=12
    else
        THE_MONTH=$LAST_MONTH
    fi
    THE_YEAR=`printf "%04d" $THE_YEAR`
    THE_MONTH=`printf "%02d" $THE_MONTH`

    mkdir -p $LOG_DIR/$THE_YEAR/$THE_MONTH
    mv $LOG_DIR/$THE_YEAR$THE_MONTH* $LOG_DIR/$THE_YEAR/$THE_MONTH/ 2>/dev/null
fi
